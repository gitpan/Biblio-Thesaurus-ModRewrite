<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
	   "http://www.w3.org/TR/html4/loose.dtd">

<html>
<head>
<title>ontomap</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
   <script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAA2O1tB20d8Myc9ArgOKG0fRRkx-LjecAMBMFtaUPruk_En0pVxxTFhqaBF91Po0RO_FcHcQZ9fMbGZQ" type="text/javascript"></script>

    <script type="text/javascript">
		function load() {
			radius = 10;
			flag = 0;
			if (GBrowserIsCompatible()) {
				map = new GMap2(document.getElementById("map"));
				zbr = new GClientGeocoder();
				map.setCenter(new GLatLng(39.399872, -7.224454), 6);
				map.addControl(new GSmallMapControl());
				var topRight = new GControlPosition(G_ANCHOR_TOP_RIGHT, new GSize(10,10));
				map.addControl(new GScaleControl(), topRight);
			}
			var args = '?';
			if(document.checkbox.city.checked)
				args = args + 'city=1&';
			if(document.checkbox.country.checked)
				args = args + 'country=1&';
			if(document.checkbox.museum.checked)
				args = args + 'museum=1&';
			if(document.checkbox.castle.checked)
				args = args + 'castle=1&';
			GDownloadUrl("http://nrc.homelinux.org/ontomap/locs.cgi"+args,processData);
		}

		function search(str) {
			zbr.getLatLng(str, show);
		}

		function show(p) {
			if(p) { 
				map.clearOverlays();
				map.setZoom(10);
				map.panTo(p); 
				drawHere(p)
				drawC(p);
				flag = 1;
			}
			else { alert("Address not found."); }
		}

		function drawHere(p) {
				//alert(p.lat()+"/"+p.lng())
            var sIcon = new GIcon(G_DEFAULT_ICON, 'images/icons/here.png' );
            sMarker = new GMarker(p, {draggable: true, icon: sIcon});

            GEvent.addListener(sMarker, "dragend", function() {
               var pp = sMarker.getLatLng();
               //map.clearOverlays();
               //drawHere(pp);
               //drawC(pp);
					show(pp);
            });
            map.addOverlay(sMarker);
		}

		processData = function(data) {
			var jsonData = eval('(' + data + ')');

			for (var i=0; i<jsonData.markers.length; i++) { 
				var point = new GLatLng(jsonData.markers[i].lat, jsonData.markers[i].lng); 
				var marker = createMarker(point, jsonData.markers[i].desc, jsonData.markers[i].name, jsonData.markers[i].is); 
				map.addOverlay(marker); 
        } 
			document.getElementById("statusz").innerHTML="";
		}

		processThis = function(s) { 
			document["grafo"].src="http://nrc.homelinux.org/ontomap/images/"+s+".png";
			s = s.replace('_',' ');
			document.getElementById("titulo").innerHTML="Relations for: <i>"+s+"</i>";
		}

      function createMarker(point,desc,term,is) {
			var marker;
			var sIcon;
			if (is == 'country') {
            sIcon = new GIcon(G_DEFAULT_ICON);
            sIcon.image = 'images/i_country.png';
				sIcon.shadow = 'images/flag-shadow.png';
				sIcon.iconSize = new GSize(24,24);
				sIcon.shadowSize = new GSize(40,40);
				sIcon.iconAnchor = new GPoint(10, 10);
				sIcon.infoWindowAnchor = new GPoint(1, 1);
				marker = new GMarker(point, {draggable: false, icon: sIcon});
			}
			else if (is == 'city') {
				sIcon = new GIcon(G_DEFAULT_ICON);
            sIcon.image = 'images/i_city.png';
            sIcon.shadow = 'images/flag-shadow.png';
            sIcon.iconSize = new GSize(24,24);
            sIcon.shadowSize = new GSize(40,40);
            sIcon.iconAnchor = new GPoint(10,10);
            sIcon.infoWindowAnchor = new GPoint(1, 1);
				marker = new GMarker(point, {draggable: false, icon: sIcon});
			}
			else if (is == 'castle') {
            sIcon = new GIcon(G_DEFAULT_ICON);
            sIcon.image = 'images/i_castle.png';
            sIcon.shadow = 'images/flag-shadow.png';
            sIcon.iconSize = new GSize(24,24);
            sIcon.shadowSize = new GSize(40,40);
            sIcon.iconAnchor = new GPoint(10, 10);
            sIcon.infoWindowAnchor = new GPoint(1, 1);
            marker = new GMarker(point, {draggable: false, icon: sIcon});
			}
         else if (is == 'museum') {
            sIcon = new GIcon(G_DEFAULT_ICON);
            sIcon.image = 'images/i_museum.png';
            sIcon.shadow = 'images/flag-shadow.png';
            sIcon.iconSize = new GSize(24,24);
            sIcon.shadowSize = new GSize(40,40);
            sIcon.iconAnchor = new GPoint(10, 10);
            sIcon.infoWindowAnchor = new GPoint(1, 1);
            marker = new GMarker(point, {draggable: false, icon: sIcon});
         }
			else {
				marker = new GMarker(point, {draggable: false});
			}
			GEvent.addListener(marker, "click", function() {
				marker.openInfoWindowHtml(desc);
				document.getElementById("titulo").innerHTML="Loading image...";
				GDownloadUrl("http://nrc.homelinux.org/ontomap/createG.cgi?term="+term,processThis);
			});
			return marker;
      }

    </script>

</head>
<body style="background-color: #666; font-family: tahoma, arial, sans-serif; font-size: 11px; padding: 20px; " onload="var map; var zbr; var sMarker; var lat; var lng; var radius; load();">

<div id="wrapper" style="margin: 0 auto; padding: 10px; background-color: #FFF; border: 1px solid #000;">
	<div style="float: left;"  id="left">
		<div id="map" style="width:400px;height:500px; border: 1px solid #888;"></div>
		<div style="display: block; float: right;" id="statusz">Loading map...</div>
	</div>
	<div style="float: left; padding: 20px;" id="right">
     	<div style="border: solid 0px grey; background-color: white; color: black;">Filters</div>
		<div style=" display: block; margin-left: auto; margin-right: auto; border: solid 1px grey; padding: 50px; padding-bottom: 20px">
			<form name='checkbox'>
				<input type="checkbox" checked="yes" name="city"><img width=12 height=12 src="images/i_city.png"> Cities
				<input type="checkbox" checked="yes" name="country"><img width=12 height=12 src="images/i_country.png"> Countries
				<input type="checkbox" checked="yes" name="museum"><img width=12 height=12 src="images/i_museum.png"> Museums
				<input type="checkbox" checked="yes" name="castle"><img width=12 height=12 src="images/i_castle.png"> Castles
				<br><br><br>
				<input onclick="document.getElementById('statusz').innerHTML='Loading map...'; load(); return false;" style=" display: block; margin-left: auto; margin-right: auto;" type="submit" value="   Reload map!   ">
			</form>
		</div>
		<br>
		<div style="border: solid 0px grey;">
      	<div style="border: solid 0px grey; background-color: white; color: black;" id="titulo"></div>
			<div style="border: solid 1px grey;"><img style="display: block; margin-left: auto; margin-right: auto;" name='grafo' src=''></div>
		</div>
	</div>
<div style="clear: both;"></diV
</div>

</body>
</html>
